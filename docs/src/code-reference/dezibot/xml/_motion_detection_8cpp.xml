<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.13.2" xml:lang="en-US">
  <compounddef id="_motion_detection_8cpp" kind="file" language="C++">
    <compoundname>MotionDetection.cpp</compoundname>
    <includes refid="_motion_detection_8h" local="yes">MotionDetection.h</includes>
    <includes local="no">math.h</includes>
    <incdepgraph>
      <node id="5">
        <label>IMU_CMDs.h</label>
        <link refid="_i_m_u___c_m_ds_8h"/>
      </node>
      <node id="1">
        <label>dezibot/src/motionDetection/MotionDetection.cpp</label>
        <link refid="_motion_detection_8cpp"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>MotionDetection.h</label>
        <link refid="_motion_detection_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="4">
        <label>Arduino.h</label>
      </node>
      <node id="3">
        <label>SPI.h</label>
      </node>
      <node id="6">
        <label>math.h</label>
      </node>
    </incdepgraph>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="preprocessor">#include<sp/>&quot;<ref refid="_motion_detection_8h" kindref="compound">MotionDetection.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;math.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"><ref refid="class_motion_detection_1a599a8e3991b40a19fc79bac5a47b0932" kindref="member">MotionDetection::MotionDetection</ref>(){</highlight></codeline>
<codeline lineno="5"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_motion_detection_1ae918b3dde9606190b7ee22f821fa342e" kindref="member">handler</ref><sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>SPIClass(FSPI);</highlight></codeline>
<codeline lineno="6"><highlight class="normal">};</highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_motion_detection_1adb3527c0ab3636a7fae351480897a39e" kindref="member">MotionDetection::begin</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">){</highlight></codeline>
<codeline lineno="9"><highlight class="normal"><sp/><sp/><sp/><sp/>pinMode(34,OUTPUT);</highlight></codeline>
<codeline lineno="10"><highlight class="normal"><sp/><sp/><sp/><sp/>digitalWrite(34,HIGH);</highlight></codeline>
<codeline lineno="11"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_motion_detection_1ae918b3dde9606190b7ee22f821fa342e" kindref="member">handler</ref>-&gt;begin(36,37,35,34);</highlight></codeline>
<codeline lineno="12"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>Accel<sp/>and<sp/>Gyroscop<sp/>to<sp/>Low<sp/>Noise</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a0f0eed1cd292d83c67481523c09f0cf3" kindref="member">PWR_MGMT0</ref>,0x1F);</highlight></codeline>
<codeline lineno="14"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//busy<sp/>Wait<sp/>for<sp/>startup<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"><sp/><sp/><sp/><sp/>delayMicroseconds(250);</highlight></codeline>
<codeline lineno="16"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>accelconfig</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(0x21,0x05);</highlight></codeline>
<codeline lineno="18"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>Gyroconfig</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(0x20,0x25);</highlight></codeline>
<codeline lineno="20"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>Gyro<sp/>Filter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(0x23,0x37);</highlight></codeline>
<codeline lineno="22"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//Prepare<sp/>FIFO<sp/>to<sp/>take<sp/>Accel<sp/>and<sp/>Gyro<sp/>data</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aeb5ab5ae5ab7ba81221ff0d922380a13" kindref="member">initFIFO</ref>();</highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1a026101b13bc5b101a23d9037848c88c5" kindref="member">stopFIFO</ref>();</highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="26"><highlight class="normal">};</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_motion_detection_1ab087c9d705181b9ba5077f8d258507b8" kindref="member">MotionDetection::end</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">){</highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a0f0eed1cd292d83c67481523c09f0cf3" kindref="member">PWR_MGMT0</ref>,0x00);</highlight></codeline>
<codeline lineno="30"><highlight class="normal">};</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"><ref refid="struct_i_m_u_result" kindref="compound">IMUResult</ref><sp/><ref refid="class_motion_detection_1aee34d3385f3a35ee42c5f486dc32aa5a" kindref="member">MotionDetection::getAcceleration</ref>(){</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/>IMUResult<sp/>result;</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/>result.<ref refid="struct_i_m_u_result_1a4aba5f1752ec744e02874e570ac03fab" kindref="member">x</ref><sp/>=<sp/><ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1adeb9efc08ab4b871ed478d6ec2ff086c" kindref="member">ACCEL_DATA_X_HIGH</ref>)&lt;&lt;8<sp/>|<sp/><ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a70cd46c5087352624e1d7a13071ac223" kindref="member">ACCEL_DATA_X_LOW</ref>);</highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/>result.<ref refid="struct_i_m_u_result_1afd779c1be8193773f8e3aaa1cada94b8" kindref="member">y</ref><sp/>=<sp/><ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1ab4c8cb1168c504e78e5817ead085b6cd" kindref="member">ACCEL_DATA_Y_HIGH</ref>)&lt;&lt;8<sp/>|<sp/><ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1ae8114228b8b09344254465f2da042317" kindref="member">ACCEL_DATA_Y_LOW</ref>);</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/>result.<ref refid="struct_i_m_u_result_1a2bec9a2c94326d4ddc44f8a110c4f915" kindref="member">z</ref><sp/>=<sp/><ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a4676d440ba44d73b8ffc552e978384fa" kindref="member">ACCEL_DATA_Z_HIGH</ref>)&lt;&lt;8<sp/>|<sp/><ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1ad3c3b6bcc8a3fb896b76fa7b254a84d8" kindref="member">ACCEL_DATA_Z_LOW</ref>);</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="38"><highlight class="normal">};</highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"><ref refid="struct_i_m_u_result" kindref="compound">IMUResult</ref><sp/><ref refid="class_motion_detection_1a81171c485732f2ae40c7f5faa9476f8a" kindref="member">MotionDetection::getRotation</ref>(){</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/>IMUResult<sp/>result;</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/>result.<ref refid="struct_i_m_u_result_1a4aba5f1752ec744e02874e570ac03fab" kindref="member">x</ref><sp/>=<sp/><ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a842f32baf84c9a81c535a3ac7db2ca15" kindref="member">GYRO_DATA_X_HIGH</ref>)<sp/>&lt;&lt;8;</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/>result.<ref refid="struct_i_m_u_result_1a4aba5f1752ec744e02874e570ac03fab" kindref="member">x</ref><sp/>|=<sp/><ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1ac2f58c8a076e2a4e968d9e97d452679d" kindref="member">GYRO_DATA_X_LOW</ref>);</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/>result.<ref refid="struct_i_m_u_result_1afd779c1be8193773f8e3aaa1cada94b8" kindref="member">y</ref><sp/>=<sp/><ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1adc32ed599cea9ba0538c8d52f12cff73" kindref="member">GYRO_DATA_Y_HIGH</ref>)&lt;&lt;8;</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/>result.<ref refid="struct_i_m_u_result_1afd779c1be8193773f8e3aaa1cada94b8" kindref="member">y</ref><sp/>|=<sp/><ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1abe9775332a5692399e8b04ceb1ea79f4" kindref="member">GYRO_DATA_Y_LOW</ref>);</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/>result.<ref refid="struct_i_m_u_result_1a2bec9a2c94326d4ddc44f8a110c4f915" kindref="member">z</ref><sp/>=<sp/><ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1aee4e40c314e67e540da8f09c8fe87216" kindref="member">GYRO_DATA_Z_HIGH</ref>)&lt;&lt;8;</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/>result.<ref refid="struct_i_m_u_result_1a2bec9a2c94326d4ddc44f8a110c4f915" kindref="member">z</ref><sp/>|=<sp/><ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a0146e9d7d64671dc4249cb5efd2fb404" kindref="member">GYRO_DATA_Z_LOW</ref>);</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="49"><highlight class="normal">};</highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/><ref refid="class_motion_detection_1af9448de508b81cf68fb299eecdc0da55" kindref="member">MotionDetection::getTemperature</ref>(){</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/>int16_t<sp/>raw_temperatur<sp/>=<sp/><ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1aaa4e6781d227e969f829def0f7b206cc" kindref="member">REG_TEMP_HIGH</ref>)&lt;&lt;8;</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/>raw_temperatur<sp/>|=<sp/><ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a6063067900925daaeb976928acca1173" kindref="member">REG_TEMP_LOW</ref>);<sp/></highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>raw_temperatur/128<sp/>+25;</highlight></codeline>
<codeline lineno="54"><highlight class="normal">};</highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal">int8_t<sp/><ref refid="class_motion_detection_1a77fdeb48595d646258218d3b378a36a7" kindref="member">MotionDetection::getWhoAmI</ref>(){</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a9fcb9e460d175bfc7ab4d80bf788b43a" kindref="member">WHO_AM_I</ref>);<sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="58"><highlight class="normal">};</highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_motion_detection_1a3935eccf9e7773772a39c70485ed28f2" kindref="member">MotionDetection::isShaken</ref>(uint32_t<sp/>threshold<sp/>,uint8_t<sp/>axis){</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/>IMUResult<sp/>measurment1;</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/>IMUResult<sp/>measurment2;</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/>uint<sp/>count<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(uint<sp/>i<sp/>=<sp/>0;i&lt;20;i++){</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>measurment1<sp/>=<sp/>this-&gt;<ref refid="class_motion_detection_1aee34d3385f3a35ee42c5f486dc32aa5a" kindref="member">getAcceleration</ref>();</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>delayMicroseconds(10);</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>measurment2<sp/>=<sp/>this-&gt;<ref refid="class_motion_detection_1aee34d3385f3a35ee42c5f486dc32aa5a" kindref="member">getAcceleration</ref>();</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(((axis<sp/>&amp;&amp;<sp/><ref refid="_motion_detection_8h_1ae3996976d8ffb3e58d88f58227473f8ea8fbcdc66e72c998377080c5aed044884" kindref="member">xAxis</ref>)<sp/>&gt;<sp/>0)<sp/>&amp;&amp;<sp/>(abs(abs(measurment1.<ref refid="struct_i_m_u_result_1a4aba5f1752ec744e02874e570ac03fab" kindref="member">x</ref>)-abs(measurment2.<ref refid="struct_i_m_u_result_1a4aba5f1752ec744e02874e570ac03fab" kindref="member">x</ref>))&gt;threshold))<sp/>||</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(((axis<sp/>&amp;&amp;<sp/><ref refid="_motion_detection_8h_1ae3996976d8ffb3e58d88f58227473f8ea3123e0676bbf5648acb1df5a54f4a784" kindref="member">yAxis</ref>)<sp/>&gt;<sp/>0)<sp/>&amp;&amp;<sp/>(abs(abs(measurment1.<ref refid="struct_i_m_u_result_1afd779c1be8193773f8e3aaa1cada94b8" kindref="member">y</ref>)-abs(measurment2.<ref refid="struct_i_m_u_result_1afd779c1be8193773f8e3aaa1cada94b8" kindref="member">y</ref>))&gt;threshold))<sp/>||</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(((axis<sp/>&amp;&amp;<sp/><ref refid="_motion_detection_8h_1ae3996976d8ffb3e58d88f58227473f8ea8b398ee6e2441b74d36b507261499da9" kindref="member">zAxis</ref>)<sp/>&gt;<sp/>0)<sp/>&amp;&amp;<sp/>(abs(abs(measurment1.<ref refid="struct_i_m_u_result_1a2bec9a2c94326d4ddc44f8a110c4f915" kindref="member">z</ref>)-abs(measurment2.<ref refid="struct_i_m_u_result_1a2bec9a2c94326d4ddc44f8a110c4f915" kindref="member">z</ref>))&gt;threshold))){</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>count++;</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>delayMicroseconds(15);</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(count<sp/>&gt;<sp/>6);</highlight></codeline>
<codeline lineno="77"><highlight class="normal">};</highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_motion_detection_1aaaa6f0499a0ba42aab0e1136b7bd4aa9" kindref="member">MotionDetection::calibrateZAxis</ref>(uint<sp/>gforceValue){</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1a283f7d0020218e771e6eb99e08397073" kindref="member">gForceCalib</ref><sp/>=<sp/>gforceValue;</highlight></codeline>
<codeline lineno="81"><highlight class="normal">};</highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><ref refid="struct_orientation" kindref="compound">Orientation</ref><sp/><ref refid="class_motion_detection_1a7016032b7d81e44a80c23820f772feb8" kindref="member">MotionDetection::getTilt</ref>(){</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/>uint<sp/>tolerance<sp/>=<sp/>200;</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/>IMUResult<sp/>reading<sp/>=<sp/>this-&gt;<ref refid="class_motion_detection_1aee34d3385f3a35ee42c5f486dc32aa5a" kindref="member">getAcceleration</ref>();</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>flipped<sp/>=<sp/>reading.<ref refid="struct_i_m_u_result_1a2bec9a2c94326d4ddc44f8a110c4f915" kindref="member">z</ref><sp/>&lt;<sp/>0;</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>accelrationStrenght<sp/>=<sp/>sqrt(reading.<ref refid="struct_i_m_u_result_1a4aba5f1752ec744e02874e570ac03fab" kindref="member">x</ref>*reading.<ref refid="struct_i_m_u_result_1a4aba5f1752ec744e02874e570ac03fab" kindref="member">x</ref>+reading.<ref refid="struct_i_m_u_result_1afd779c1be8193773f8e3aaa1cada94b8" kindref="member">y</ref>*reading.<ref refid="struct_i_m_u_result_1afd779c1be8193773f8e3aaa1cada94b8" kindref="member">y</ref>+reading.<ref refid="struct_i_m_u_result_1a2bec9a2c94326d4ddc44f8a110c4f915" kindref="member">z</ref>*reading.<ref refid="struct_i_m_u_result_1a2bec9a2c94326d4ddc44f8a110c4f915" kindref="member">z</ref>);</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//check<sp/>if<sp/>reading<sp/>is<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(abs(accelrationStrenght-this-&gt;<ref refid="class_motion_detection_1a283f7d0020218e771e6eb99e08397073" kindref="member">gForceCalib</ref>)<sp/>&gt;<sp/>tolerance<sp/>){</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//total<sp/>accelration<sp/>is<sp/>not<sp/>gravitational<sp/>force,<sp/>error</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Orientation{INT_MAX,INT_MAX};</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="93"><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//calculates<sp/>the<sp/>angle<sp/>between<sp/>the<sp/>two<sp/>axis,<sp/>therefore<sp/>value<sp/>between<sp/>0-90</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>yAngle;</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>xAngle;</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(reading.<ref refid="struct_i_m_u_result_1a2bec9a2c94326d4ddc44f8a110c4f915" kindref="member">z</ref><sp/>!=<sp/>0){</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>yAngle<sp/>=<sp/>atan(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal">(reading.<ref refid="struct_i_m_u_result_1a4aba5f1752ec744e02874e570ac03fab" kindref="member">x</ref>)/reading.<ref refid="struct_i_m_u_result_1a2bec9a2c94326d4ddc44f8a110c4f915" kindref="member">z</ref>)*180/3.1415+0.5;</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>xAngle<sp/>=<sp/>atan(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal">(reading.<ref refid="struct_i_m_u_result_1afd779c1be8193773f8e3aaa1cada94b8" kindref="member">y</ref>)/reading.<ref refid="struct_i_m_u_result_1a2bec9a2c94326d4ddc44f8a110c4f915" kindref="member">z</ref>)*180/3.1415+0.5;</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>yAngle<sp/>=<sp/>90*(reading.<ref refid="struct_i_m_u_result_1a4aba5f1752ec744e02874e570ac03fab" kindref="member">x</ref><sp/>&gt;<sp/>0)<sp/>-<sp/>(reading.<ref refid="struct_i_m_u_result_1a4aba5f1752ec744e02874e570ac03fab" kindref="member">x</ref><sp/>&lt;<sp/>0);</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>xAngle<sp/>=<sp/>90*(reading.<ref refid="struct_i_m_u_result_1afd779c1be8193773f8e3aaa1cada94b8" kindref="member">y</ref><sp/>&gt;<sp/>0)<sp/>-<sp/>(reading.<ref refid="struct_i_m_u_result_1afd779c1be8193773f8e3aaa1cada94b8" kindref="member">y</ref><sp/>&lt;<sp/>0);</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//shift<sp/>quadrants<sp/>depending<sp/>on<sp/>signum</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//esp<sp/>is<sp/>facing<sp/>down<sp/>(normal<sp/>position)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(reading.<ref refid="struct_i_m_u_result_1a2bec9a2c94326d4ddc44f8a110c4f915" kindref="member">z</ref><sp/>&gt;<sp/>0){</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(reading.<ref refid="struct_i_m_u_result_1afd779c1be8193773f8e3aaa1cada94b8" kindref="member">y</ref><sp/>&lt;<sp/>0){</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>xAngle<sp/>=<sp/>xAngle+180;</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>xAngle<sp/>=<sp/>-1*(180-xAngle);</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(reading.<ref refid="struct_i_m_u_result_1a4aba5f1752ec744e02874e570ac03fab" kindref="member">x</ref><sp/>&lt;<sp/>0){</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>yAngle<sp/>=<sp/>yAngle+180;</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>yAngle<sp/>=<sp/>-1*(180-yAngle);</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Orientation{xAngle,yAngle};</highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal">};</highlight></codeline>
<codeline lineno="125"><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"><ref refid="_motion_detection_8h_1a224b9163917ac32fc95a60d8c1eec3aa" kindref="member">Direction</ref><sp/><ref refid="class_motion_detection_1aa3b54cc2b5bc712f4e95d9820b1d01b8" kindref="member">MotionDetection::getTiltDirection</ref>(uint<sp/>tolerance){</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="class_motion_detection_1aee34d3385f3a35ee42c5f486dc32aa5a" kindref="member">getAcceleration</ref>().z<sp/>&gt;<sp/>0){</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="_motion_detection_8h_1a224b9163917ac32fc95a60d8c1eec3aaac311a71173e9a9e29f650408570c896d" kindref="member">Flipped</ref>;</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/>Orientation<sp/>Rot<sp/>=<sp/>this-&gt;<ref refid="class_motion_detection_1a7016032b7d81e44a80c23820f772feb8" kindref="member">getTilt</ref>();</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((Rot.<ref refid="struct_orientation_1a52c2eaa5ad28a92b0da4408e250d7597" kindref="member">xRotation</ref><sp/>==<sp/>INT_MAX)){</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="_motion_detection_8h_1a224b9163917ac32fc95a60d8c1eec3aaa4dfd42ec49d09d8c6555c218301cc30f" kindref="member">Error</ref>;</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(abs(abs(Rot.<ref refid="struct_orientation_1a52c2eaa5ad28a92b0da4408e250d7597" kindref="member">xRotation</ref>)-abs(Rot.<ref refid="struct_orientation_1a57fcda7d106952b9d415bd0049422c9b" kindref="member">yRotation</ref>))&gt;tolerance){</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//determine<sp/>which<sp/>axis<sp/>is<sp/>more<sp/>tiltet</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(abs(Rot.<ref refid="struct_orientation_1a52c2eaa5ad28a92b0da4408e250d7597" kindref="member">xRotation</ref>)&gt;abs(Rot.<ref refid="struct_orientation_1a57fcda7d106952b9d415bd0049422c9b" kindref="member">yRotation</ref>)){</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//test<sp/>if<sp/>dezibot<sp/>is<sp/>tilted<sp/>left<sp/>or<sp/>right</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(Rot.<ref refid="struct_orientation_1a52c2eaa5ad28a92b0da4408e250d7597" kindref="member">xRotation</ref><sp/>&gt;<sp/>0){</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="_motion_detection_8h_1a224b9163917ac32fc95a60d8c1eec3aaad48f7af8c070184f3774c8e85854eb66" kindref="member">Right</ref>;</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="_motion_detection_8h_1a224b9163917ac32fc95a60d8c1eec3aaa9d4d8b0b72fc2659da772d761a3c5ecb" kindref="member">Left</ref>;</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//test<sp/>if<sp/>robot<sp/>is<sp/>tilted<sp/>front<sp/>or<sp/>back</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(Rot.<ref refid="struct_orientation_1a57fcda7d106952b9d415bd0049422c9b" kindref="member">yRotation</ref><sp/>&gt;<sp/>0){</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="_motion_detection_8h_1a224b9163917ac32fc95a60d8c1eec3aaa0cf84affdc2d20637bc9e8120b80ae95" kindref="member">Front</ref>;</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="_motion_detection_8h_1a224b9163917ac32fc95a60d8c1eec3aaa36625780699489b5c3dfceadfb9c27d1" kindref="member">Back</ref>;</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//dezibot<sp/>is<sp/>(with<sp/>tolerance)<sp/>leveled</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="_motion_detection_8h_1a224b9163917ac32fc95a60d8c1eec3aaa32bb6c621f52f6a0932c646d5ed47f91" kindref="member">Neutral</ref>;</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="155"><highlight class="normal">};</highlight></codeline>
<codeline lineno="156"><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal">uint8_t<sp/><ref refid="class_motion_detection_1a580de3c513e465fb405ff347b8813bd4" kindref="member">MotionDetection::cmdRead</ref>(uint8_t<sp/>reg){</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(<ref refid="_i_m_u___c_m_ds_8h_1a9c953a6c538020e644127ee080608021" kindref="member">CMD_READ</ref><sp/>|<sp/>(reg<sp/>&amp;<sp/><ref refid="_i_m_u___c_m_ds_8h_1a15b16c1073c60f0be255caf0a60251be" kindref="member">ADDR_MASK</ref>));</highlight></codeline>
<codeline lineno="159"><highlight class="normal">};</highlight></codeline>
<codeline lineno="160"><highlight class="normal">uint8_t<sp/><ref refid="class_motion_detection_1a1e6e2f65509099a1a79420239b5fbcd8" kindref="member">MotionDetection::cmdWrite</ref>(uint8_t<sp/>reg){</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(<ref refid="_i_m_u___c_m_ds_8h_1a7391deb9c3a262ded3e186e94eb884e2" kindref="member">CMD_WRITE</ref><sp/>|<sp/>(reg<sp/>&amp;<sp/><ref refid="_i_m_u___c_m_ds_8h_1a15b16c1073c60f0be255caf0a60251be" kindref="member">ADDR_MASK</ref>));</highlight></codeline>
<codeline lineno="162"><highlight class="normal">};</highlight></codeline>
<codeline lineno="163"><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal">uint8_t<sp/><ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">MotionDetection::readRegister</ref>(uint8_t<sp/>reg){</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_motion_detection_1ae918b3dde9606190b7ee22f821fa342e" kindref="member">handler</ref>-&gt;beginTransaction(SPISettings(<ref refid="class_motion_detection_1a7e4235e1e4f6019c0c9751706a0efd5a" kindref="member">frequency</ref>,SPI_MSBFIRST,SPI_MODE0));</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/>digitalWrite(34,LOW);</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/>uint8_t<sp/>result;</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/>result<sp/>=<sp/><ref refid="class_motion_detection_1ae918b3dde9606190b7ee22f821fa342e" kindref="member">handler</ref>-&gt;transfer(<ref refid="class_motion_detection_1a580de3c513e465fb405ff347b8813bd4" kindref="member">cmdRead</ref>(reg));</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/>result<sp/>=<sp/><ref refid="class_motion_detection_1ae918b3dde9606190b7ee22f821fa342e" kindref="member">handler</ref>-&gt;transfer(0x00);</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/>digitalWrite(34,HIGH);</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_motion_detection_1ae918b3dde9606190b7ee22f821fa342e" kindref="member">handler</ref>-&gt;endTransaction();<sp/></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="173"><highlight class="normal">};</highlight></codeline>
<codeline lineno="174"><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal">uint8_t<sp/><ref refid="class_motion_detection_1a479599e1ccee2aeba55a22c567d46128" kindref="member">MotionDetection::readFromRegisterBank</ref>(registerBank<sp/>bank,uint8_t<sp/>reg){</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/>uint8_t<sp/>result<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">(bank){</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal">(<ref refid="class_motion_detection_1a22d39744aa50717e569b4097cb03829ea09a115ca6d04fd1e40cb2a29bd967ab9" kindref="member">MREG1</ref>):</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1aa5f283d6065cca95c379cc87d00208ca" kindref="member">BLK_SEL_R</ref>,0x00);</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal">(<ref refid="class_motion_detection_1a22d39744aa50717e569b4097cb03829ea50f0e931ad0d42d822e96857f5c2e2fd" kindref="member">MREG2</ref>):</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1aa5f283d6065cca95c379cc87d00208ca" kindref="member">BLK_SEL_R</ref>,0x28);</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal">(<ref refid="class_motion_detection_1a22d39744aa50717e569b4097cb03829ea5179c1fd752fb6c571fc10c55d996813" kindref="member">MREG3</ref>):</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1aa5f283d6065cca95c379cc87d00208ca" kindref="member">BLK_SEL_R</ref>,0x50);</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a17aaa6b0d70922c06da32394f74ce67c" kindref="member">MADDR_R</ref>,reg);</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/>delayMicroseconds(10);</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/>result=this-&gt;<ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1aecc48a560e67afb7d70c9082e43451ae" kindref="member">M_R</ref>);</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/>delayMicroseconds(10);</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1a6a3c4844f237aa19ea630a168e364ca8" kindref="member">resetRegisterBankAccess</ref>();</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="194"><highlight class="normal">};</highlight></codeline>
<codeline lineno="195"><highlight class="normal"></highlight></codeline>
<codeline lineno="196"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_motion_detection_1acd275bd42ed7c5f72743a18e9804e703" kindref="member">MotionDetection::writeToRegisterBank</ref>(registerBank<sp/>bank,<sp/>uint8_t<sp/>reg,<sp/>uint8_t<sp/>value){</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal">((this-&gt;<ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a96b8d0eef91f5573a91ecaf9c33ef9f5" kindref="member">MCLK_RDY</ref>))&amp;0x08!=0x08){</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Serial.println(</highlight><highlight class="stringliteral">&quot;CLK<sp/>not<sp/>rdy&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>delay(100);</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/>uint8_t<sp/>result<sp/>=<sp/>this-&gt;<ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a0f0eed1cd292d83c67481523c09f0cf3" kindref="member">PWR_MGMT0</ref>);</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>Idle<sp/>Bit</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a0f0eed1cd292d83c67481523c09f0cf3" kindref="member">PWR_MGMT0</ref>,result|0x10);</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">(bank){</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal">(<ref refid="class_motion_detection_1a22d39744aa50717e569b4097cb03829ea09a115ca6d04fd1e40cb2a29bd967ab9" kindref="member">MREG1</ref>):</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a26d57436cdc27d7ff90682c527f64b3f" kindref="member">BLK_SEL_W</ref>,0x00);</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal">(<ref refid="class_motion_detection_1a22d39744aa50717e569b4097cb03829ea50f0e931ad0d42d822e96857f5c2e2fd" kindref="member">MREG2</ref>):</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a26d57436cdc27d7ff90682c527f64b3f" kindref="member">BLK_SEL_W</ref>,0x28);</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal">(<ref refid="class_motion_detection_1a22d39744aa50717e569b4097cb03829ea5179c1fd752fb6c571fc10c55d996813" kindref="member">MREG3</ref>):</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a26d57436cdc27d7ff90682c527f64b3f" kindref="member">BLK_SEL_W</ref>,0x50);</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a716263d45480a3a38aa1e708b6694563" kindref="member">MADDR_W</ref>,reg);</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a358ac4ec91c07f67d49958ede6574698" kindref="member">M_W</ref>,value);</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/>delayMicroseconds(10);</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a0f0eed1cd292d83c67481523c09f0cf3" kindref="member">PWR_MGMT0</ref>,result&amp;0xEF);</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1a6a3c4844f237aa19ea630a168e364ca8" kindref="member">resetRegisterBankAccess</ref>();</highlight></codeline>
<codeline lineno="220"><highlight class="normal">};</highlight></codeline>
<codeline lineno="221"><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_motion_detection_1a6a3c4844f237aa19ea630a168e364ca8" kindref="member">MotionDetection::resetRegisterBankAccess</ref>(){</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1aa5f283d6065cca95c379cc87d00208ca" kindref="member">BLK_SEL_R</ref>,0x00);</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a26d57436cdc27d7ff90682c527f64b3f" kindref="member">BLK_SEL_W</ref>,0x00);</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a17aaa6b0d70922c06da32394f74ce67c" kindref="member">MADDR_R</ref>,0x00);</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a716263d45480a3a38aa1e708b6694563" kindref="member">MADDR_W</ref>,0x00);</highlight></codeline>
<codeline lineno="227"><highlight class="normal">};</highlight></codeline>
<codeline lineno="228"><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_motion_detection_1aeb5ab5ae5ab7ba81221ff0d922380a13" kindref="member">MotionDetection::initFIFO</ref>(){</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>TMST_CONFIG1_MREG1<sp/>TMST_CONFIIG1_TMST_EN</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1acd275bd42ed7c5f72743a18e9804e703" kindref="member">writeToRegisterBank</ref>(<ref refid="class_motion_detection_1a22d39744aa50717e569b4097cb03829ea09a115ca6d04fd1e40cb2a29bd967ab9" kindref="member">MREG1</ref>,<ref refid="_i_m_u___c_m_ds_8h_1a3795e1b22a716d94b7573893077d8a07" kindref="member">TMST_CONFIG1</ref>,0x00);</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>FiFO<sp/>config<sp/>5<sp/>GYRO_EN,TMST_FSYNC,<sp/>ACCEL_EN,<sp/>WM_GT_TH_EN</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1acd275bd42ed7c5f72743a18e9804e703" kindref="member">writeToRegisterBank</ref>(<ref refid="class_motion_detection_1a22d39744aa50717e569b4097cb03829ea09a115ca6d04fd1e40cb2a29bd967ab9" kindref="member">MREG1</ref>,<ref refid="_i_m_u___c_m_ds_8h_1a9b12a7fa2ab39cf0c03c6e9127eb3ef3" kindref="member">FIFO_CONFIG5</ref>,0x23);</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>FOF_CONFIG2<sp/>0x1<sp/>(INT<sp/>triggerd<sp/>each<sp/>packaged)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a4ddfefd55ac8494f2c892c1527f73a3c" kindref="member">FIFO_CONFIG2</ref>,0x0A);</highlight></codeline>
<codeline lineno="236"><highlight class="normal">};</highlight></codeline>
<codeline lineno="237"><highlight class="normal"></highlight></codeline>
<codeline lineno="238"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_motion_detection_1aafb36c50b274ad26c75bd76ae7097f10" kindref="member">MotionDetection::startFIFO</ref>(){</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>INTF_CONFIG0<sp/>FIFO_COUNT_FORMAT<sp/>to<sp/>Records<sp/>and<sp/>SENSOR_DATA_ENDIAN<sp/>to<sp/>Big<sp/>Endian</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a99c150c949d8ca2fcb0f88024c039751" kindref="member">INTF_CONFIG0</ref>,0x60);</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>FIFO_CONFIG1<sp/>to<sp/>BYPASS<sp/>Off</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a0f8b0bdd6f2960e72f790b0b0c843bd7" kindref="member">FIFO_CONFIG1</ref>,0x00);</highlight></codeline>
<codeline lineno="243"><highlight class="normal">}</highlight></codeline>
<codeline lineno="244"><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_motion_detection_1a026101b13bc5b101a23d9037848c88c5" kindref="member">MotionDetection::stopFIFO</ref>(){</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>INTF_CONFIG0<sp/>FIFO_COUNT_FORMAT<sp/>to<sp/>bytes<sp/>and<sp/>SENSOR_DATA_ENDIAN<sp/>to<sp/>Little<sp/>Endian<sp/>(default)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a99c150c949d8ca2fcb0f88024c039751" kindref="member">INTF_CONFIG0</ref>,0x30);</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>FIFO_CONFIG1<sp/>BYPASS<sp/>On</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a0f8b0bdd6f2960e72f790b0b0c843bd7" kindref="member">FIFO_CONFIG1</ref>,0x01);</highlight></codeline>
<codeline lineno="250"><highlight class="normal">}</highlight></codeline>
<codeline lineno="251"><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal">uint<sp/><ref refid="class_motion_detection_1a154bfb74496b7e015d16fc30d3d5c258" kindref="member">MotionDetection::getDataFromFIFO</ref>(<ref refid="struct_f_i_f_o___package" kindref="compound">FIFO_Package</ref>*<sp/>buffer){</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/>int16_t<sp/>fifocount<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/>int8_t<sp/>fifohigh<sp/>=<sp/>this-&gt;<ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1adbbef0e95665e066deb615f04b347491" kindref="member">FIFO_COUNTH</ref>);</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/>int8_t<sp/>fifolow<sp/>=<sp/>this-&gt;<ref refid="class_motion_detection_1a69cfe9da940521cb120e658a526c3eeb" kindref="member">readRegister</ref>(<ref refid="_i_m_u___c_m_ds_8h_1adbede65b2cfa35abde780bd704077f53" kindref="member">FIFO_COUNTL</ref>);<sp/><sp/></highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/>fifocount<sp/>=<sp/>(fifohigh&lt;&lt;8)|fifolow;</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_motion_detection_1ae918b3dde9606190b7ee22f821fa342e" kindref="member">handler</ref>-&gt;beginTransaction(SPISettings(<ref refid="class_motion_detection_1a7e4235e1e4f6019c0c9751706a0efd5a" kindref="member">frequency</ref>,SPI_MSBFIRST,SPI_MODE0));</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/>digitalWrite(34,LOW);</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_motion_detection_1ae918b3dde9606190b7ee22f821fa342e" kindref="member">handler</ref>-&gt;transfer(<ref refid="class_motion_detection_1a580de3c513e465fb405ff347b8813bd4" kindref="member">cmdRead</ref>(<ref refid="_i_m_u___c_m_ds_8h_1a88e074c68027a1dee870dbb2536165cc" kindref="member">FIFO_DATA</ref>));</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_motion_detection_1ae918b3dde9606190b7ee22f821fa342e" kindref="member">handler</ref>-&gt;transfer(<ref refid="class_motion_detection_1a7632ede4ab9bd90bb9eaa8d76d2d75d8" kindref="member">buf</ref>,16*fifocount);</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/>digitalWrite(34,HIGH);</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_motion_detection_1ae918b3dde9606190b7ee22f821fa342e" kindref="member">handler</ref>-&gt;endTransaction();</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">writeRegister</ref>(0x02,0x04);</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/>delayMicroseconds(10);</highlight></codeline>
<codeline lineno="266"><highlight class="normal"></highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i&lt;fifocount;i++){</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buffer[i].<ref refid="struct_f_i_f_o___package_1a508631d74240d70901d42f2d1d60ff94" kindref="member">header</ref><sp/>=<sp/><ref refid="class_motion_detection_1a7632ede4ab9bd90bb9eaa8d76d2d75d8" kindref="member">buf</ref>[0x00+16*i];</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buffer[i].<ref refid="struct_f_i_f_o___package_1a13d017781f1658ab069ea54bdc0dc767" kindref="member">accel</ref>.<ref refid="struct_i_m_u_result_1a4aba5f1752ec744e02874e570ac03fab" kindref="member">x</ref><sp/>=<sp/>(<ref refid="class_motion_detection_1a7632ede4ab9bd90bb9eaa8d76d2d75d8" kindref="member">buf</ref>[0x02+16*i]&lt;&lt;8)|<ref refid="class_motion_detection_1a7632ede4ab9bd90bb9eaa8d76d2d75d8" kindref="member">buf</ref>[0x01+16*i];<sp/></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buffer[i].<ref refid="struct_f_i_f_o___package_1a13d017781f1658ab069ea54bdc0dc767" kindref="member">accel</ref>.<ref refid="struct_i_m_u_result_1afd779c1be8193773f8e3aaa1cada94b8" kindref="member">y</ref><sp/>=<sp/>(<ref refid="class_motion_detection_1a7632ede4ab9bd90bb9eaa8d76d2d75d8" kindref="member">buf</ref>[0x04+16*i]&lt;&lt;8)|<ref refid="class_motion_detection_1a7632ede4ab9bd90bb9eaa8d76d2d75d8" kindref="member">buf</ref>[0x03+16*i];<sp/></highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buffer[i].<ref refid="struct_f_i_f_o___package_1a13d017781f1658ab069ea54bdc0dc767" kindref="member">accel</ref>.<ref refid="struct_i_m_u_result_1a2bec9a2c94326d4ddc44f8a110c4f915" kindref="member">z</ref><sp/>=<sp/>(<ref refid="class_motion_detection_1a7632ede4ab9bd90bb9eaa8d76d2d75d8" kindref="member">buf</ref>[0x06+16*i]&lt;&lt;8)|<ref refid="class_motion_detection_1a7632ede4ab9bd90bb9eaa8d76d2d75d8" kindref="member">buf</ref>[0x05+16*i];<sp/></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buffer[i].<ref refid="struct_f_i_f_o___package_1a9bbd1ce3aabb96eaf372f88e60d05097" kindref="member">gyro</ref>.<ref refid="struct_i_m_u_result_1a4aba5f1752ec744e02874e570ac03fab" kindref="member">x</ref><sp/>=<sp/>(<ref refid="class_motion_detection_1a7632ede4ab9bd90bb9eaa8d76d2d75d8" kindref="member">buf</ref>[0x08+16*i]&lt;&lt;8)|<ref refid="class_motion_detection_1a7632ede4ab9bd90bb9eaa8d76d2d75d8" kindref="member">buf</ref>[0x07+16*i];<sp/></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buffer[i].<ref refid="struct_f_i_f_o___package_1a9bbd1ce3aabb96eaf372f88e60d05097" kindref="member">gyro</ref>.<ref refid="struct_i_m_u_result_1afd779c1be8193773f8e3aaa1cada94b8" kindref="member">y</ref><sp/>=<sp/>(<ref refid="class_motion_detection_1a7632ede4ab9bd90bb9eaa8d76d2d75d8" kindref="member">buf</ref>[0x0A+16*i]&lt;&lt;8)|<ref refid="class_motion_detection_1a7632ede4ab9bd90bb9eaa8d76d2d75d8" kindref="member">buf</ref>[0x09+16*i];<sp/></highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buffer[i].<ref refid="struct_f_i_f_o___package_1a9bbd1ce3aabb96eaf372f88e60d05097" kindref="member">gyro</ref>.<ref refid="struct_i_m_u_result_1a2bec9a2c94326d4ddc44f8a110c4f915" kindref="member">z</ref><sp/>=<sp/>(<ref refid="class_motion_detection_1a7632ede4ab9bd90bb9eaa8d76d2d75d8" kindref="member">buf</ref>[0x0C+16*i]&lt;&lt;8)|<ref refid="class_motion_detection_1a7632ede4ab9bd90bb9eaa8d76d2d75d8" kindref="member">buf</ref>[0x0B+16*i];<sp/></highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buffer[i].<ref refid="struct_f_i_f_o___package_1aac437ccb8deb8c45e1af081160d38771" kindref="member">temperature</ref><sp/>=<sp/><ref refid="class_motion_detection_1a7632ede4ab9bd90bb9eaa8d76d2d75d8" kindref="member">buf</ref>[0x0D+16*i];<sp/></highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buffer[i].<ref refid="struct_f_i_f_o___package_1a3bae340fe5623a440211616310e83ef3" kindref="member">timestamp</ref><sp/>=<sp/>(<ref refid="class_motion_detection_1a7632ede4ab9bd90bb9eaa8d76d2d75d8" kindref="member">buf</ref>[0x0F+16*i]&lt;&lt;8)|<ref refid="class_motion_detection_1a7632ede4ab9bd90bb9eaa8d76d2d75d8" kindref="member">buf</ref>[0x0E<sp/>+16*i];<sp/></highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>fifocount;</highlight></codeline>
<codeline lineno="279"><highlight class="normal">};</highlight></codeline>
<codeline lineno="280"><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_motion_detection_1aba17fa0603316ef24fd7880aa2276e2b" kindref="member">MotionDetection::writeRegister</ref>(uint8_t<sp/>reg,<sp/>uint8_t<sp/>value){</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_motion_detection_1ae918b3dde9606190b7ee22f821fa342e" kindref="member">handler</ref>-&gt;beginTransaction(SPISettings(<ref refid="class_motion_detection_1a7e4235e1e4f6019c0c9751706a0efd5a" kindref="member">frequency</ref>,SPI_MSBFIRST,SPI_MODE0));</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/>digitalWrite(34,LOW);</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_motion_detection_1ae918b3dde9606190b7ee22f821fa342e" kindref="member">handler</ref>-&gt;transfer(reg);</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_motion_detection_1ae918b3dde9606190b7ee22f821fa342e" kindref="member">handler</ref>-&gt;transfer(value);</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/>digitalWrite(34,HIGH);</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/>delayMicroseconds(10);</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_motion_detection_1ae918b3dde9606190b7ee22f821fa342e" kindref="member">handler</ref>-&gt;endTransaction();</highlight></codeline>
<codeline lineno="289"><highlight class="normal">};</highlight></codeline>
    </programlisting>
    <location file="dezibot/src/motionDetection/MotionDetection.cpp"/>
  </compounddef>
</doxygen>
